#Codex-CTO
# CardMint Environment Configuration

# Node Environment
NODE_ENV=development
LOG_LEVEL=info

# Server Configuration (Deterministic - No Fallbacks)
API_PORT=3000
WS_PORT=3001
DASH_PORT=5173
HOST=0.0.0.0

# Dashboard Configuration
VITE_API_BASE=http://localhost:3000

# SQLite Database Configuration (local file)
DB_PATH=./data/cardmint.db
CARDMINT_DB_PATH=./data/cardmint.db

# Input Bus Telemetry
INPUT_TELEMETRY_PATH=./data/input-telemetry.csv

# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Valuation Service Configuration
VALUATION_ENABLED=true

# Marketplace Fees (as decimals)
FEE_EBAY_RAW=0.13
FEE_FANATICS_GRADED=0.10

# Costs in cents
GRADING_COST_BASE=2000      # $20 base grading cost
SHIP_TO_GRADER=500          # $5 shipping to grader
SHIP_TO_BUYER_RAW=300       # $3 shipping for raw cards
SHIP_TO_BUYER_GRADED=500    # $5 shipping for graded cards

# Grade outcome probabilities
PSA9_PROBABILITY=0.70       # 70% chance of PSA 9
PSA10_PROBABILITY=0.30      # 30% chance of PSA 10

# Cache settings
CACHE_TTL_MINUTES=15        # 15 minute cache TTL

# Camera Configuration
CAMERA_MODE=USB  # USB, ETHERNET, SSH
CAMERA_IP=
CAMERA_DEVICE_ID=
CAMERA_FPS=60
CAMERA_RESOLUTION=1920x1080
CAMERA_FORMAT=MJPG
CAMERA_TIMEOUT_MS=10000  # Real-world capture timing is ~5000ms, safety margin needed
CAMERA_BUILD_DIR=
CAMERA_DAEMON_MODE=true  # Use persistent daemon for optimal performance (eliminates 200-300ms spawn overhead)
INVENTORY_IMAGES_DIR=./data/inventory_images
CAPTURE_STAGING_DIR=/dev/shm/cardmint_staging  # tmpfs for optimal I/O performance
FAKE_CAMERA=0

# Processing Configuration
MAX_WORKERS=20
WORKER_CONCURRENCY=3
JOB_TIMEOUT_MS=5000
RETRY_ATTEMPTS=3
RETRY_DELAY_MS=1000

# Performance Configuration
USE_GPU=true
GPU_DEVICE_ID=0
ENABLE_PROFILING=false
ENABLE_METRICS=true

# OCR Configuration
OCR_MODEL=PaddleOCR
OCR_LANG=en
OCR_CONFIDENCE_THRESHOLD=0.7

# PriceCharting API Configuration
PRICECHARTING_API_KEY=
PRICECHARTING_CACHE_TTL=86400  # 24 hours in seconds
PRICECHARTING_BASE_URL=https://www.pricecharting.com

# Pokemon TCG API Configuration
POKEMONTCG_API_KEY=
POKEMONTCG_BASE_URL=https://api.pokemontcg.io/v2
POKEMONTCG_CACHE_TTL=86400  # 24 hours in seconds
POKEMONTCG_IMAGE_CACHE_DIR=./cache/card_images

# Monitoring
OTEL_ENABLED=true
OTEL_ENDPOINT=http://localhost:4318
METRICS_PORT=9091

# System Optimization
CPU_CORES=2-7  # Isolated cores for processing
MEMORY_LIMIT_MB=2048

# HEIC Integration (Strategy A: normalize on ingest)
ALLOW_HEIC=0
HEIC_PRESERVE_ORIGINAL=1
HEIC_NORMALIZE_QUALITY=90
HEIC_MAX_DIM_PX=

# LM Studio Dual Instance Configuration (August 29, 2025)
# Mac M4: Primary vision model for card recognition
LMSTUDIO_MAC_URL=http://10.0.24.174:1234
LMSTUDIO_MAC_MODEL=qwen2.5-vl-7b-instruct
LMSTUDIO_MAC_TIMEOUT_MS=10000

# Fedora: Secondary verification model for text validation
LMSTUDIO_LOCAL_URL=http://localhost:1234
LMSTUDIO_LOCAL_MODEL=openai/gpt-oss-20b
LMSTUDIO_LOCAL_IDENTIFIER=cardmint-verifier
LMSTUDIO_LOCAL_TIMEOUT_MS=2000

# Verification Pipeline Configuration
LMSTUDIO_VERIFIER_ENABLED=true

#Codex-CTO Local-First Recognition
# Data Strategy: prefer Local matching, fall back to ML only when needed
DATA_ROOT=./data
LOCAL_FIRST_MATCH=true
LOCAL_MATCH_MIN_CONF=0.85
LOCAL_PRECOMPUTE_HASHES=true
LOCAL_CACHE_DIR=./data/cache/local
LOCAL_MODE=hybrid
PRICECHARTING_CSV_PATH=./data/pricecharting_pokemon.csv

# OCR Engine Configuration
OCR_ENGINE=hybrid
OCR_WARMUP=true
OCR_NUM_PSM=7
OCR_PROMO_PSM=8
OCR_WHITELIST_NUM=0123456789/
OCR_WHITELIST_PROMO=ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789
OCR_NORMALIZE_HEIGHT=64
OCR_APPLY_CLAHE=true
OCR_THRESHOLD_METHOD=sauvola
OCR_MORPHOLOGY_OPS=close

# Template Matching Configuration
SET_ICON_NCC_THRESH=0.78
SET_ICON_SCALES=0.75,1.0,1.25
ZNCC_EARLY_EXIT=0.90

# Perceptual Hash Configuration
PHASH_MAX_RESULTS=100
PHASH_HAMMING_THRESHOLD=15
PHASH_USE_ARTWORK_ROI=true

# SV Era Configuration
SV_OCR_ENABLED=true
SV_REG_MARKS=D,E,F,G,H
SV_ROTATION_TOLERANCE=5

# ML Verifier Configuration
LMSTUDIO_VERIFIER_ENABLED=true
LMSTUDIO_VERIFIER_THRESHOLD=0.70
LMSTUDIO_VERIFIER_MAX_TOKENS=200
LMSTUDIO_VERIFIER_TEMPERATURE=0.1
LMSTUDIO_FALLBACK_ON_ERROR=true

# LM Studio CLI Management
LMSTUDIO_CLI_PATH=/home/profusionai/.lmstudio/bin/lms
LMSTUDIO_AUTO_START_FEDORA=true
LMSTUDIO_MODEL_TTL_SECONDS=3600
