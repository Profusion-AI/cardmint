PORT=4000
# Database path - Oct 28 pricing migrations applied to cardmint_dev.db
SQLITE_DB=apps/backend/cardmint_dev.db
CAPTURE_OUTPUT_DIR=data/captures
CAPTURE_DRIVER=pi-hq
CAPTURE_ADAPTER=gphoto2
CAPTURE_BINARY=../SonySDK/CrSDK_v2.00.00_20250805a_Linux64PC/build/CardMintCapture
CAPTURE_BACKEND_URL=http://127.0.0.1:4000
CAPTURE_TIMEOUT_MS=30000
LMSTUDIO_BASE_URL=http://127.0.0.1:12345
LMSTUDIO_MODEL=magistral-small-2509
REDIS_URL=redis://127.0.0.1:6379
PRICECHARTING_API_KEY=
POKEMONTCG_API_KEY=
POKEMONPRICETRACKER_API_KEY=
POKEPRICETRACKER_API_TIER=free          # 'free' (100 calls/day) or 'paid' (20000 calls/day)
POKEPRICETRACKER_DAILY_LIMIT=100       # Daily quota: 100 for free, 20000 for paid
POKEPRICETRACKER_TIMEOUT_MS=15000      # API timeout in milliseconds
EXTERNAL_LLM_BUDGET_CENTS=0
CARDMINT_ENV=development

# Inference Configuration (A/B Testing)
INFERENCE_MODE=lmstudio
INFERENCE_TIMEOUT_MS=30000

# OpenAI Configuration (for openai/hybrid/ab-test modes)
OPENAI_API_KEY=
OPENAI_MODEL=gpt-5-mini-2025-08-07      # Model snapshot (gpt-5-mini, gpt-4o-mini, etc.)
OPENAI_TEMPERATURE=0                     # 0=deterministic, 2=creative (keep 0 for extraction)
OPENAI_MAX_OUTPUT_TOKENS=256            # Cap on response tokens (256 sufficient for structured output)
# OPENAI_SEED=101                        # Optional: for reproducible results (uncomment to enable)
OPENAI_IMAGE_DETAIL=high

# A/B Testing Configuration
AB_TEST_SAMPLE_RATE=0.1
AB_TEST_LOG_PATH=results/ab-test-results.jsonl

# OpenAI Cost Controls
OPENAI_BUDGET_CENTS_DAILY=100
OPENAI_ALERT_THRESHOLD_CENTS=80

# Path A (OpenAI) Retry/Fallback Configuration (Oct 8, 2025)
OPENAI_TIMEOUT_MS=12000           # 12s timeout ceiling for Path A
OPENAI_RETRY_ONCE=1               # Enable single retry with jitter (1=enabled, 0=disabled)
OPENAI_STORE_DEFAULT=true         # Store conversations for model memory (always-on in prod)
ALLOW_STORE_SESSION_TOGGLE=true   # Allow dev session toggle for store flag

# Shadow Lane Configuration (measurement only, auto-gating)
SHADOW_SAMPLE_RATE=0.10           # 10% sampling rate for shadow measurements
AUTO_PAUSE_DEPTH=11               # Pause shadow lane when queue depth >= 11
AUTO_RESUME_DEPTH=8               # Resume shadow lane when queue depth <= 8

# Hot-reload and Graceful Shutdown
GRACEFUL_SHUTDOWN_MS=10000        # Time to wait for graceful shutdown (10s)

# Pi5 Kiosk Capture Driver (pi-hq)
CAPTURE_PI_BASEURL=http://192.0.2.100:8000   # Pi5 kiosk API endpoint (replace with your kiosk IP)
CAPTURE_PI_TOKEN=                            # Bearer token for kiosk auth (if enabled)
#
# Legacy env var names (still supported):
# PI5_KIOSK_URL=http://192.0.2.100:8000
# PI5_QUEUE_TOKEN=

# Cloudinary Image Hosting (E-Commerce CDN)
CLOUDINARY_CLOUD_NAME=                   # From Cloudinary dashboard (e.g., "dxxxxx")
CLOUDINARY_API_KEY=                      # From Cloudinary dashboard
CLOUDINARY_API_SECRET=                   # From Cloudinary dashboard (keep secret!)
CLOUDINARY_FOLDER=cardmint/products      # Folder structure in Cloudinary

# EverShop Integration
EVERSHOP_API_URL=https://cardmintshop.com/api    # EverShop admin API endpoint
EVERSHOP_ADMIN_TOKEN=                              # Admin API token from EverShop
EVERSHOP_EXPORT_DIR=exports/evershop               # Directory for CSV exports (fallback path)

# Sync + Sale Safeguards
SYNC_ENABLED=false
EVERSHOP_SALE_SYNC_ENABLED=false
EVERSHOP_SALE_SYNC_MAX_RETRIES=5

# EasyPost Shipping Integration (Label Purchase)
EASYPOST_API_KEY=                          # EasyPost API key (test or production)
EASYPOST_TEST_MODE=true                    # true=sandbox, false=live (default: true for safety)

# Ship-From Address (CardMint return address)
EASYPOST_FROM_NAME=CardMint
EASYPOST_FROM_COMPANY=
EASYPOST_FROM_STREET1=                     # Required: Street address line 1
EASYPOST_FROM_STREET2=
EASYPOST_FROM_CITY=                        # Required: City
EASYPOST_FROM_STATE=                       # Required: State (2-letter code)
EASYPOST_FROM_ZIP=                         # Required: ZIP code
EASYPOST_FROM_PHONE=
EASYPOST_FROM_EMAIL=support@cardmintshop.com

# Parcel Dimensions (default for trading cards)
EASYPOST_PARCEL_WEIGHT_BASE_OZ=2.0         # Base weight for packaging materials
EASYPOST_PARCEL_WEIGHT_PER_CARD_OZ=0.1     # ~0.1oz per card
EASYPOST_PARCEL_LENGTH_IN=6.0
EASYPOST_PARCEL_WIDTH_IN=4.0
EASYPOST_PARCEL_HEIGHT_IN=0.5

# Stripe Integration (Payments)
STRIPE_SECRET_KEY=                         # Stripe secret key (sk_test_... or sk_live_...)
STRIPE_WEBHOOK_SECRET=                     # Stripe webhook signing secret (whsec_...)
STRIPE_PUBLISHABLE_KEY=                    # Stripe publishable key (pk_test_... or pk_live_...)

# Klaviyo Integration (Email Marketing)
KLAVIYO_PRIVATE_API_KEY=                   # Klaviyo private API key (Events + Profiles APIs)
KLAVIYO_SUBSCRIBE_LIST_ID=                 # Klaviyo list ID for newsletter signups (optional; enables /api/subscribe → list sync)

# Cart Reservation System
CART_RESERVATION_TTL_MINUTES=15            # How long items stay reserved in cart (default: 15)
CART_MAX_ITEMS_PER_SESSION=10              # Max items per cart session
CART_MAX_EXTENSION_WINDOW_MINUTES=60       # Max total hold window before forced release
CART_RESERVE_RATE_LIMIT_RPM=30             # Rate limit: reserves per minute per IP

# Lot Builder (Multi-Item Discounts)
LOTBUILDER_RATE_LIMIT_RPM=60               # Rate limit for /api/lot/preview
LOTBUILDER_LLM_TIMEOUT_MS=5000             # LLM timeout for creative discount copy
LOTBUILDER_LLM_CACHE_TTL_SEC=3600          # Cache TTL for LLM responses (1 hour)

# ============================================
# WorkOS Identity (P1.2 - Community/Account Auth)
# ============================================
WORKOS_ENABLED=false                         # Kill-switch: false=bypass, true=enable
WORKOS_CLIENT_ID=                            # WorkOS client ID (client_...)
WORKOS_API_KEY=                              # WorkOS API key (sk_test_... or sk_...)
WORKOS_REDIRECT_URI=http://localhost:4000/api/auth/workos/callback  # OAuth callback URL (AuthKit → backend)
WORKOS_COOKIE_SECRET=                        # 32+ char random string (openssl rand -base64 32)
WORKOS_COOKIE_NAME=cm_session                # Session cookie name (default: cm_session)
WORKOS_COOKIE_MAX_AGE_SEC=604800             # Session cookie TTL in seconds (default: 7 days)

# ============================================
# Cloudflare Turnstile (P1.3 ZIP Fallback Anti-Abuse)
# ============================================
TURNSTILE_SITE_KEY=                          # Public site key (also needed in frontend)
TURNSTILE_SECRET_KEY=                        # Secret key for server-side verification

# ============================================
# Resend Transactional Email (P1.3 Claim Links)
# ============================================
RESEND_API_KEY=                              # Resend API key (re_...)

# ============================================
# Claim Order Flow (P1.3 - Email Link Primary)
# ============================================
CLAIM_ORDER_ENABLED=false                    # Kill-switch: false=disabled, true=enabled
CLAIM_TOKEN_TTL_MINUTES=30                   # Claim link validity (default: 30 min)
CLAIM_EMAIL_RATE_LIMIT_HOURLY=3              # Max claim emails per order per hour
CLAIM_EMAIL_RATE_LIMIT_DAILY=10              # Max claim emails per order per day
CLAIM_ZIP_RATE_LIMIT_HOURLY=3                # Max ZIP verify attempts per order per hour
CLAIM_ZIP_RATE_LIMIT_DAILY=10                # Max ZIP verify attempts per order per day
CLAIM_ZIP_LOCKOUT_HOURS=24                   # Lockout duration after 3 failed ZIP attempts
PUBLIC_BASE_URL=                             # Public URL for claim emails (e.g., https://cardmintshop.com)

# ============================================
# Privacy DSAR Endpoints (SEC-001)
# ============================================
PRIVACY_EXPORT_ENABLED=false                 # Kill-switch for /api/privacy/export (default: false)
