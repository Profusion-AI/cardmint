<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="api-url" content="http://localhost:3000">
    <meta name="ws-url" content="ws://localhost:3001">
    <title>CardMint Vision - Batch Results Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --dark: #2C3E50;
            --light: #F7F9FC;
            --gold: #FFD93D;
            --silver: #C0C0C0;
            --bronze: #CD7F32;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            from {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.4;
            }
            90% {
                opacity: 0.4;
            }
            to {
                transform: translateY(-100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .container {
            max-width: 1400px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            backdrop-filter: blur(10px);
            animation: slideUp 0.6s ease-out;
            position: relative;
            z-index: 1;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .pokeball {
            width: 50px;
            height: 50px;
            background: linear-gradient(to bottom, #FF0000 50%, white 50%);
            border-radius: 50%;
            border: 3px solid #2C3E50;
            position: relative;
            animation: rotate 3s ease-in-out infinite;
        }

        .pokeball::after {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background: white;
            border: 3px solid #2C3E50;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes rotate {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(360deg); }
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            letter-spacing: -1px;
        }

        .subtitle {
            color: #6B7280;
            font-size: 1.1em;
            margin-top: 10px;
        }

        /* Main content grid */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        /* Camera/Upload Section */
        .capture-section {
            background: #F8FAFC;
            border-radius: 20px;
            padding: 30px;
        }

        .capture-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #6B7280;
            border: 2px solid #E5E7EB;
        }

        .btn-secondary:hover {
            background: #F9FAFB;
            border-color: #D1D5DB;
        }

        .camera-view {
            width: 100%;
            height: 400px;
            background: #1F2937;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
            position: relative;
            overflow: hidden;
        }


        /* Recognition Results Section */
        .results-section {
            background: #F8FAFC;
            border-radius: 20px;
            padding: 30px;
        }

        .model-status {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .model-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .model-card.active {
            border-color: var(--success);
            background: linear-gradient(to bottom, rgba(16, 185, 129, 0.05), white);
        }

        .model-card.processing {
            border-color: var(--warning);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .model-name {
            font-weight: 700;
            color: #374151;
            margin-bottom: 5px;
        }

        .model-accuracy {
            font-size: 0.9em;
            color: #6B7280;
        }

        .model-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 5px;
        }

        .model-status-indicator.ready {
            background: var(--success);
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Progress bars */
        .progress-container {
            margin: 20px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: #6B7280;
        }

        .progress-bar {
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Results Display */
        .card-result {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #E5E7EB;
        }

        .card-result.high-confidence {
            border-color: var(--success);
            background: linear-gradient(to bottom, rgba(16, 185, 129, 0.02), white);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-name {
            font-size: 1.4em;
            font-weight: 700;
            color: #1F2937;
        }

        .confidence-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            color: white;
        }

        .confidence-high {
            background: var(--success);
        }

        .confidence-medium {
            background: var(--warning);
        }

        .confidence-low {
            background: var(--error);
        }

        .card-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #F3F4F6;
        }

        .detail-label {
            color: #6B7280;
            font-size: 0.9em;
        }

        .detail-value {
            color: #1F2937;
            font-weight: 600;
        }

        /* API Validation Status */
        .validation-status {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #F3F4F6 0%, #E5E7EB 100%);
            border-radius: 16px;
            animation: fadeIn 0.5s ease;
        }

        .validation-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1em;
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
        }

        .validation-icon {
            font-size: 1.2em;
        }

        .validation-items {
            display: grid;
            gap: 12px;
        }

        .validation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .validation-label {
            color: #6B7280;
            font-size: 0.9em;
        }

        .validation-value {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #1F2937;
            font-weight: 600;
        }

        .validation-value .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .validation-value .status-dot.success {
            background: var(--success);
        }

        .validation-value .status-dot.error {
            background: var(--error);
        }

        .validation-value .status-dot.pending {
            background: #FFC107;
            animation: pulse 1.5s infinite;
        }

        /* Status indicators */
        .status-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            border-radius: 16px;
            padding: 15px 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: var(--success);
        }

        .status-dot.disconnected {
            background: var(--error);
        }

        .status-text {
            font-size: 0.9em;
            color: #374151;
            font-weight: 600;
        }

        /* Resource monitor */
        .resource-monitor {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            min-width: 200px;
        }

        .resource-title {
            font-size: 0.9em;
            font-weight: 700;
            color: #374151;
            margin-bottom: 10px;
        }

        .resource-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.85em;
        }

        .resource-label {
            color: #6B7280;
        }

        .resource-value {
            color: #1F2937;
            font-weight: 600;
        }

        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #E5E7EB;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* File upload area */
        .upload-area {
            border: 3px dashed #CBD5E1;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #F0F4FF;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: #EEF2FF;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #9CA3AF;
        }

        .upload-text {
            color: #6B7280;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .upload-hint {
            color: #9CA3AF;
            font-size: 0.9em;
        }

        #fileInput {
            display: none;
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #E5E7EB;
        }

        .tab-button {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: #6B7280;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .tab-button:hover {
            color: #374151;
            background: #F9FAFB;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: transparent;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* API Console Styles */
        .api-console {
            background: #1F2937;
            color: #E5E7EB;
            border-radius: 12px;
            padding: 20px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85em;
            height: 500px;
            overflow-y: auto;
            position: relative;
        }

        .console-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #374151;
        }

        .console-title {
            color: #10B981;
            font-weight: 600;
            font-size: 1.1em;
        }

        .copy-console-btn {
            padding: 6px 12px;
            background: #374151;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .copy-console-btn:hover {
            background: #4B5563;
        }

        .copy-console-btn.copied {
            background: #10B981;
        }

        .console-entry {
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            border-left: 3px solid #6B7280;
        }

        .console-entry.request {
            border-left-color: #3B82F6;
        }

        .console-entry.response {
            border-left-color: #10B981;
        }

        .console-entry.error {
            border-left-color: #EF4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .console-entry.warning {
            border-left-color: #F59E0B;
            background: rgba(245, 158, 11, 0.1);
        }

        .console-timestamp {
            color: #6B7280;
            font-size: 0.8em;
            margin-bottom: 5px;
        }

        .console-method {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            margin-right: 8px;
        }

        .console-method.GET {
            background: #3B82F6;
            color: white;
        }

        .console-method.POST {
            background: #10B981;
            color: white;
        }

        .console-url {
            color: #93C5FD;
        }

        .console-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
            font-weight: 600;
        }

        .console-status.success {
            background: #10B981;
            color: white;
        }

        .console-status.error {
            background: #EF4444;
            color: white;
        }

        .console-body {
            margin-top: 8px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            word-wrap: break-word;
        }

        .console-confidence {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
            margin-left: 10px;
            font-weight: 600;
        }

        .console-confidence.low {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }

        .console-confidence.medium {
            background: rgba(245, 158, 11, 0.2);
            color: #F59E0B;
        }
    </style>
  <script type="module" crossorigin src="/assets/banner-BpERPkmb.js"></script>
</head>
  <body>
    <!-- Animated particles background -->
    <div class="particles" id="particles"></div>

    <!-- Main container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="pokeball"></div>
                <h1>CardMint Results</h1>
            </div>
            <p class="subtitle">Batch Recognition Analytics & Performance Dashboard</p>
        </div>

        <!-- Main content grid -->
        <div class="content-grid">
            <!-- Left side: Batch Results -->
            <div class="capture-section">
                <h2 style="color: #1F2937; margin-bottom: 20px;">üìä Batch Results</h2>
                
                <!-- Batch Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px;">
                    <div style="background: white; border-radius: 12px; padding: 20px; text-align: center; border-top: 4px solid #667eea;">
                        <div style="font-size: 2.2em; font-weight: 800; color: #1F2937; margin-bottom: 8px;" id="totalProcessed">0</div>
                        <div style="color: #6B7280; font-size: 0.9em; font-weight: 600; text-transform: uppercase;">Cards Processed</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; text-align: center; border-top: 4px solid #10B981;">
                        <div style="font-size: 2.2em; font-weight: 800; color: #1F2937; margin-bottom: 8px;" id="successRate">0%</div>
                        <div style="color: #6B7280; font-size: 0.9em; font-weight: 600; text-transform: uppercase;">Success Rate</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; text-align: center; border-top: 4px solid #F59E0B;">
                        <div style="font-size: 2.2em; font-weight: 800; color: #1F2937; margin-bottom: 8px;" id="avgAccuracy">0%</div>
                        <div style="color: #6B7280; font-size: 0.9em; font-weight: 600; text-transform: uppercase;">Avg Accuracy</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; text-align: center; border-top: 4px solid #EF4444;">
                        <div style="font-size: 2.2em; font-weight: 800; color: #1F2937; margin-bottom: 8px;" id="avgProcessingTime">0ms</div>
                        <div style="color: #6B7280; font-size: 0.9em; font-weight: 600; text-transform: uppercase;">Avg Time</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <select id="batchSelect" style="padding: 8px 16px; border: 2px solid #E5E7EB; border-radius: 8px; background: white;">
                        <option value="today">Today's Batch</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                    <button class="btn btn-primary" onclick="refreshBatchData()">
                        üîÑ Refresh
                    </button>
                </div>

                <!-- Batch Processing Chart -->
                <div style="background: white; border-radius: 12px; padding: 20px; height: 300px; display: flex; align-items: center; justify-content: center; border: 1px solid #E5E7EB;">
                    <div style="text-align: center; color: #9CA3AF;">
                        <div style="font-size: 3em; margin-bottom: 15px;">üìà</div>
                        <div style="font-size: 1.2em; margin-bottom: 10px;">Batch Processing Trends</div>
                        <div style="font-size: 0.9em; color: #6B7280;">
                            Processing rate: <span id="processingRate">45 cards/hour</span><br>
                            Peak accuracy: <span id="peakAccuracy">98.5%</span><br>
                            Total batches: <span id="totalBatches">12</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right side: Analytics & Console -->
            <div class="results-section">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-button active" onclick="switchTab('results')" id="resultsTab">
                        üìä Model Performance
                    </button>
                    <button class="tab-button" onclick="switchTab('console')" id="consoleTab">
                        üîß Batch Console
                    </button>
                </div>
                
                <!-- Results Tab Content -->
                <div id="resultsTabContent" class="tab-content active">
                    <!-- Model Performance Grid -->
                <div class="model-status">
                    <div class="model-card" id="mobilenetCard" style="border: 2px solid #10B981; background: linear-gradient(to bottom, rgba(16, 185, 129, 0.05), white);">
                        <div class="model-name">MobileNet</div>
                        <div style="font-size: 2em; font-weight: 800; color: #10B981; margin-bottom: 5px;" id="mobilenetAccuracy">94%</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                            <div style="text-align: center; padding: 8px; background: #F8FAFC; border-radius: 6px;">
                                <div style="font-weight: 700; color: #1F2937;" id="mobilenetProcessed">0</div>
                                <div style="color: #6B7280; font-size: 0.8em;">Processed</div>
                            </div>
                            <div style="text-align: center; padding: 8px; background: #F8FAFC; border-radius: 6px;">
                                <div style="font-weight: 700; color: #1F2937;" id="mobilenetAvgTime">0ms</div>
                                <div style="color: #6B7280; font-size: 0.8em;">Avg Time</div>
                            </div>
                        </div>
                    </div>
                    <div class="model-card" id="orbCard" style="border: 2px solid #F59E0B; background: linear-gradient(to bottom, rgba(245, 158, 11, 0.05), white);">
                        <div class="model-name">ORB Match</div>
                        <div style="font-size: 2em; font-weight: 800; color: #F59E0B; margin-bottom: 5px;" id="orbAccuracy">87%</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                            <div style="text-align: center; padding: 8px; background: #F8FAFC; border-radius: 6px;">
                                <div style="font-weight: 700; color: #1F2937;" id="orbMatches">0</div>
                                <div style="color: #6B7280; font-size: 0.8em;">Matches</div>
                            </div>
                            <div style="text-align: center; padding: 8px; background: #F8FAFC; border-radius: 6px;">
                                <div style="font-weight: 700; color: #1F2937;" id="orbAvgTime">0ms</div>
                                <div style="color: #6B7280; font-size: 0.8em;">Avg Time</div>
                            </div>
                        </div>
                    </div>
                    <div class="model-card" id="ocrCard" style="border: 2px solid #10B981; background: linear-gradient(to bottom, rgba(16, 185, 129, 0.05), white);">
                        <div class="model-name">PaddleOCR</div>
                        <div style="font-size: 2em; font-weight: 800; color: #10B981; margin-bottom: 5px;" id="ocrAccuracy">96%</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                            <div style="text-align: center; padding: 8px; background: #F8FAFC; border-radius: 6px;">
                                <div style="font-weight: 700; color: #1F2937;" id="ocrProcessed">0</div>
                                <div style="color: #6B7280; font-size: 0.8em;">Processed</div>
                            </div>
                            <div style="text-align: center; padding: 8px; background: #F8FAFC; border-radius: 6px;">
                                <div style="font-weight: 700; color: #1F2937;" id="ocrAvgTime">0ms</div>
                                <div style="color: #6B7280; font-size: 0.8em;">Avg Time</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quality Metrics -->
                <div style="background: white; padding: 20px; border-radius: 12px; margin-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: #1F2937;">üéØ Quality Metrics</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: #F8FAFC; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: 700; color: #10B981;" id="highConfidenceCount">0</div>
                            <div style="color: #6B7280; font-size: 0.9em;">High Confidence (>90%)</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #F8FAFC; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: 700; color: #F59E0B;" id="reviewRequiredCount">0</div>
                              <div style="color: #6B7280; font-size: 0.9em;">Requires Review (&lt;80%)</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #F8FAFC; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: 700; color: #EF4444;" id="failedCount">0</div>
                            <div style="color: #6B7280; font-size: 0.9em;">Failed Recognition</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #F8FAFC; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: 700; color: #667eea;" id="uniqueCardsFound">0</div>
                            <div style="color: #6B7280; font-size: 0.9em;">Unique Cards Found</div>
                        </div>
                    </div>
                </div>
                </div>
                
                <!-- Batch Console Tab Content -->
                <div id="consoleTabContent" class="tab-content">
                    <div class="api-console">
                        <div class="console-header">
                            <div class="console-title">üîß Batch Processing Console</div>
                            <div style="display: flex; gap: 10px;">
                                <button class="copy-console-btn active" onclick="filterConsole('all')">All</button>
                                <button class="copy-console-btn" onclick="filterConsole('batch')">Batches</button>
                                <button class="copy-console-btn" onclick="filterConsole('errors')">Errors</button>
                                <button class="copy-console-btn" onclick="copyConsoleToClipboard()">üìã Copy</button>
                            </div>
                        </div>
                        <div id="consoleOutput">
                            <!-- Batch entries will be added here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status indicator -->
    <div class="status-container">
        <div class="status-dot connected" id="statusDot"></div>
        <div class="status-text" id="statusText">Batch System Ready</div>
    </div>

    <!-- Resource monitor -->
    <div class="resource-monitor">
        <div class="resource-title">System Resources</div>
        <div class="resource-item">
            <span class="resource-label">RAM:</span>
            <span class="resource-value" id="ramUsage">150MB / 4GB</span>
        </div>
        <div class="resource-item">
            <span class="resource-label">CPU:</span>
            <span class="resource-value" id="cpuUsage">12%</span>
        </div>
        <div class="resource-item">
            <span class="resource-label">Models:</span>
            <span class="resource-value" id="activeModels">3 active</span>
        </div>
    </div>

    <script>
        // Batch Console logging
        const batchConsoleEntries = [];
        let currentFilter = 'all';
        
        function logBatchOperation(type, batchId, message, data = {}) {
            const timestamp = new Date().toLocaleTimeString();
            const entry = {
                timestamp,
                type,
                batchId,
                message,
                data,
                id: Date.now()
            };
            
            batchConsoleEntries.push(entry);
            if (shouldShowEntry(entry)) {
                addConsoleEntry(entry);
            }
            
            // Keep only last 100 entries
            if (batchConsoleEntries.length > 100) {
                batchConsoleEntries.shift();
            }
        }
        
        function shouldShowEntry(entry) {
            switch(currentFilter) {
                case 'batch':
                    return entry.type === 'batch' || entry.type === 'success';
                case 'errors':
                    return entry.type === 'error';
                default:
                    return true;
            }
        }
        
        function addConsoleEntry(entry) {
            const consoleOutput = document.getElementById('consoleOutput');
            if (!consoleOutput) return;
            
            const entryDiv = document.createElement('div');
            entryDiv.className = `console-entry ${entry.type}`;
            
            let html = `<div class="console-timestamp">[${entry.timestamp}]</div>`;
            
            if (entry.type === 'request') {
                html += `
                    <div>
                        <span class="console-method ${entry.method}">${entry.method}</span>
                        <span class="console-url">${entry.url}</span>
                    </div>
                `;
                if (entry.data.body) {
                    html += `<div class="console-body">Body: ${JSON.stringify(entry.data.body, null, 2)}</div>`;
                }
            } else if (entry.type === 'response') {
                html += `
                    <div>
                        <span class="console-method ${entry.method}">${entry.method}</span>
                        <span class="console-url">${entry.url}</span>
                        <span class="console-status ${entry.data.status === 200 ? 'success' : 'error'}">${entry.data.status}</span>
                    </div>
                `;
                if (entry.data.confidence !== undefined) {
                    const confClass = entry.data.confidence > 0.8 ? '' : entry.data.confidence > 0.5 ? 'medium' : 'low';
                    html += `<span class="console-confidence ${confClass}">Confidence: ${(entry.data.confidence * 100).toFixed(1)}%</span>`;
                }
                if (entry.data.result) {
                    html += `<div class="console-body">Result: ${JSON.stringify(entry.data.result, null, 2)}</div>`;
                }
            } else if (entry.type === 'error') {
                html += `
                    <div>
                        <span class="console-method ${entry.method}">${entry.method}</span>
                        <span class="console-url">${entry.url}</span>
                        <span class="console-status error">${entry.data.status || 'ERROR'}</span>
                    </div>
                    <div class="console-body">Error: ${entry.data.message || entry.data.detail || 'Unknown error'}</div>
                `;
                // Show enhanced FastAPI error details
                if (entry.data.error_type) {
                    html += `<div class="console-body">Type: ${entry.data.error_type}</div>`;
                }
                if (entry.data.service) {
                    html += `<div class="console-body">Service: ${entry.data.service}</div>`;
                }
                if (entry.data.body) {
                    html += `<div class="console-body">Request Body: ${JSON.stringify(entry.data.body, null, 2)}</div>`;
                }
            } else if (entry.type === 'warning') {
                html += `
                    <div>‚ö†Ô∏è ${entry.data.message}</div>
                `;
                if (entry.data.details) {
                    html += `<div class="console-body">${entry.data.details}</div>`;
                }
            } else if (entry.type === 'validation') {
                html += `
                    <div>
                        <span class="console-method ${entry.method}">${entry.method}</span>
                        <span class="console-url">${entry.url}</span>
                        <span class="console-status error">422</span>
                    </div>
                    <div class="console-body">Validation Error: ${entry.data.message}</div>
                `;
                if (entry.data.detail && Array.isArray(entry.data.detail)) {
                    html += `<div class="console-body">Errors: ${JSON.stringify(entry.data.detail, null, 2)}</div>`;
                }
            }
            
            entryDiv.innerHTML = html;
            consoleOutput.insertBefore(entryDiv, consoleOutput.firstChild);
            
            // Keep only visible entries in DOM
            while (consoleOutput.children.length > 50) {
                consoleOutput.removeChild(consoleOutput.lastChild);
            }
        }
        
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + 'TabContent').classList.add('active');
        }
        
        function copyConsoleToClipboard() {
            const consoleText = apiConsoleEntries.map(entry => {
                let text = `[${entry.timestamp}] ${entry.type.toUpperCase()}: ${entry.method} ${entry.url}`;
                if (entry.data) {
                    if (entry.data.status) text += ` - Status: ${entry.data.status}`;
                    if (entry.data.confidence) text += ` - Confidence: ${(entry.data.confidence * 100).toFixed(1)}%`;
                    if (entry.data.message) text += ` - ${entry.data.message}`;
                    if (entry.data.result) text += `\nResult: ${JSON.stringify(entry.data.result, null, 2)}`;
                }
                return text;
            }).join('\n\n');
            
            navigator.clipboard.writeText(consoleText).then(() => {
                const btn = document.querySelector('.copy-console-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = '‚úÖ Copied!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy console output');
            });
        }
        
        // Initialize particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        createParticles();

        // WebSocket connection for real-time updates (optional)
        let ws = null;
        const WS_URL = 'ws://localhost:3001';
        const API_URL = 'http://localhost:3000';

        function connectWebSocket() {
            try {
                ws = new WebSocket(WS_URL);
                
                ws.onopen = () => {
                    updateStatus('Connected', true);
                    console.log('WebSocket connected');
                };
                
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    handleWebSocketMessage(data);
                };
                
                ws.onerror = (error) => {
                    // Silently handle WebSocket errors - it's optional
                    console.log('WebSocket not available (optional feature)');
                    updateStatus('API Ready', true); // Still show as ready
                };
                
                ws.onclose = () => {
                    // Don't show as disconnected if WebSocket is optional
                    console.log('WebSocket closed (optional feature)');
                    // Don't attempt reconnect if it's not available
                };
            } catch (error) {
                // WebSocket not available, but that's OK
                console.log('WebSocket not available - using REST API only');
                updateStatus('API Ready', true);
            }
        }

        function handleWebSocketMessage(data) {
            if (data.type === 'progress') {
                updateProgress(data.progress, data.model);
            } else if (data.type === 'result') {
                displayResult(data);
            } else if (data.type === 'resources') {
                updateResources(data);
            }
        }

        // Capture card from camera
        async function captureCard() {
            updateStatus('Capturing...', true);
            
            try {
                const response = await fetch('/api/capture', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    updateStatus('Processing...', true);
                    // Image will be processed automatically by CaptureWatcher
                } else {
                    updateStatus('Capture failed', false);
                }
            } catch (error) {
                console.error('Capture error:', error);
                updateStatus('Error', false);
            }
        }

        // Handle file upload
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                displayImagePreview(file);
                uploadFile(file);
            }
        }
        
        // Display image preview
        function displayImagePreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const uploadArea = document.getElementById('uploadArea');
                const imagePreview = document.getElementById('imagePreview');
                const previewImage = document.getElementById('previewImage');
                const imageInfo = document.getElementById('imageInfo');
                
                // Hide upload area, show preview
                uploadArea.style.display = 'none';
                imagePreview.style.display = 'block';
                previewImage.src = e.target.result;
                
                // Show image info
                imageInfo.style.display = 'block';
                document.getElementById('imageFileName').textContent = file.name;
                document.getElementById('imageSize').textContent = formatFileSize(file.size);
                
                // Load image to get dimensions
                const img = new Image();
                img.onload = function() {
                    document.getElementById('imageDimensions').textContent = `${this.width}√ó${this.height}`;
                };
                img.src = e.target.result;
                
                // Add subtle animation
                imagePreview.style.opacity = '0';
                setTimeout(() => {
                    imagePreview.style.transition = 'opacity 0.3s ease';
                    imagePreview.style.opacity = '1';
                }, 50);
            };
            reader.readAsDataURL(file);
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        // Clear image preview
        function clearImagePreview(event) {
            if (event) {
                event.stopPropagation();
            }
            
            const uploadArea = document.getElementById('uploadArea');
            const imagePreview = document.getElementById('imagePreview');
            const imageInfo = document.getElementById('imageInfo');
            const fileInput = document.getElementById('fileInput');
            
            // Reset everything
            uploadArea.style.display = 'flex';
            imagePreview.style.display = 'none';
            imageInfo.style.display = 'none';
            fileInput.value = '';
            
            // Clear results
            resetResults();
            updateStatus('System Ready', true);
        }

        // Drag and drop support
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                displayImagePreview(file);
                uploadFile(file);
            }
        });

        // Upload file to recognition API
        async function uploadFile(file) {
            updateStatus('Uploading...', true);
            resetResults();
            
            // Show processing overlay if preview is visible
            const processingOverlay = document.getElementById('processingOverlay');
            if (document.getElementById('imagePreview').style.display === 'block') {
                processingOverlay.style.display = 'flex';
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            // Log API request
            const apiUrl = `${API_URL}/api/recognize/lightweight`;
            logApiCall('request', 'POST', apiUrl, { 
                body: { 
                    filename: file.name, 
                    size: formatFileSize(file.size),
                    type: file.type 
                } 
            });
            
            try {
                // Start progress animation
                animateModels();
                
                const startTime = Date.now();
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    body: formData
                });
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // Log successful response
                    logApiCall('response', 'POST', apiUrl, {
                        status: 200,
                        confidence: result.ensemble_confidence || result.confidence,
                        result: {
                            card_name: result.card_name,
                            set_name: result.set_name,
                            inference_time_ms: result.inference_time_ms,
                            response_time_ms: responseTime,
                            models_used: result.active_models
                        }
                    });
                    
                    // Check for low confidence
                    if (result.ensemble_confidence && result.ensemble_confidence < 0.7) {
                        logApiCall('warning', '', '', {
                            message: 'Low confidence detection',
                            details: `Card "${result.card_name}" detected with only ${(result.ensemble_confidence * 100).toFixed(1)}% confidence`
                        });
                    }
                    
                    displayResult(result);
                    updateStatus('Recognition complete', true);
                } else {
                    // Log error response
                    logApiCall('error', 'POST', apiUrl, {
                        status: response.status,
                        message: `Recognition failed with status ${response.status}`
                    });
                    updateStatus('Recognition failed', false);
                }
            } catch (error) {
                // Log network error
                logApiCall('error', 'POST', apiUrl, {
                    message: error.message || 'Network error'
                });
                console.error('Upload error:', error);
                updateStatus('Error', false);
            } finally {
                // Hide processing overlay
                processingOverlay.style.display = 'none';
            }
        }

        // Animate model cards during processing
        function animateModels() {
            const models = ['mobilenetCard', 'orbCard', 'ocrCard'];
            models.forEach((id, index) => {
                setTimeout(() => {
                    const card = document.getElementById(id);
                    card.classList.add('processing');
                    
                    setTimeout(() => {
                        card.classList.remove('processing');
                        card.classList.add('active');
                        updateProgress((index + 1) * 33);
                    }, 1000);
                }, index * 500);
            });
        }

        // Update progress bar
        function updateProgress(percent, model) {
            const fill = document.getElementById('progressFill');
            const text = document.getElementById('progressPercent');
            
            fill.style.width = percent + '%';
            text.textContent = percent + '%';
            
            if (model) {
                updateStatus(`Processing with ${model}...`, true);
            }
        }

        // Display recognition result
        function displayResult(result) {
            const resultDiv = document.getElementById('cardResult');
            resultDiv.style.display = 'block';
            
            document.getElementById('cardName').textContent = result.card_name || 'Unknown Card';
            document.getElementById('setName').textContent = result.set_name || '-';
            document.getElementById('cardNumber').textContent = result.card_number || '-';
            document.getElementById('rarity').textContent = result.rarity || '-';
            document.getElementById('inferenceTime').textContent = 
                result.inference_time_ms ? `${result.inference_time_ms.toFixed(0)}ms` : '-';
            
            // Update confidence badge
            const confidence = result.ensemble_confidence || result.confidence || 0;
            const badge = document.getElementById('confidenceBadge');
            badge.textContent = `${(confidence * 100).toFixed(1)}%`;
            
            // Update badge color based on confidence
            badge.className = 'confidence-badge';
            if (confidence >= 0.9) {
                badge.classList.add('confidence-high');
                resultDiv.classList.add('high-confidence');
            } else if (confidence >= 0.7) {
                badge.classList.add('confidence-medium');
            } else {
                badge.classList.add('confidence-low');
            }
            
            updateProgress(100);
            
            // Show API validation status
            showValidationStatus(result);
        }
        
        // Display API validation status
        function showValidationStatus(result) {
            const validationDiv = document.getElementById('validationStatus');
            validationDiv.style.display = 'block';
            
            // Simulate API validation (in production, this would come from the backend)
            const tcgApiElement = document.getElementById('tcgApiStatus');
            const marketPriceElement = document.getElementById('marketPrice');
            const officialImageElement = document.getElementById('officialImage');
            const validationMethodElement = document.getElementById('validationMethod');
            
            // Set initial pending state
            tcgApiElement.innerHTML = '<span class="status-dot pending"></span> Validating...';
            
            // Simulate API validation after a delay
            setTimeout(() => {
                // Check if we have enhanced data (would come from backend in production)
                if (result.api_validated) {
                    // Log successful API validation
                    logApiCall('response', 'GET', 'https://api.pokemontcg.io/v2/cards', {
                        status: 200,
                        confidence: result.combinedConfidence || 0.95,
                        result: {
                            validated: true,
                            card_name: result.card_name,
                            market_price: result.market_price,
                            official_image: result.officialImageUrl
                        }
                    });
                    
                    tcgApiElement.innerHTML = '<span class="status-dot success"></span> Validated';
                    marketPriceElement.textContent = result.market_price ? `$${result.market_price}` : 'N/A';
                    officialImageElement.innerHTML = '<span class="status-dot success"></span> Available';
                    validationMethodElement.textContent = result.validation_method || 'ML + API';
                } else {
                    // Log API unavailable
                    logApiCall('warning', '', '', {
                        message: 'Pokemon TCG API unavailable',
                        details: 'External validation not performed - using ML-only recognition'
                    });
                    
                    tcgApiElement.innerHTML = '<span class="status-dot error"></span> Not Available';
                    marketPriceElement.textContent = 'N/A';
                    officialImageElement.innerHTML = '<span class="status-dot error"></span> Not Available';
                    validationMethodElement.textContent = 'ML Only';
                }
            }, 1500);
        }

        // Reset results display
        function resetResults() {
            document.getElementById('cardResult').style.display = 'none';
            document.getElementById('validationStatus').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('progressPercent').textContent = '0%';
            
            // Reset model cards
            ['mobilenetCard', 'orbCard', 'ocrCard'].forEach(id => {
                const card = document.getElementById(id);
                card.classList.remove('active', 'processing');
            });
        }

        // Update status indicator
        function updateStatus(text, connected) {
            document.getElementById('statusText').textContent = text;
            const dot = document.getElementById('statusDot');
            dot.className = 'status-dot ' + (connected ? 'connected' : 'disconnected');
        }

        // Update resource monitor
        async function updateResources() {
            const apiUrl = `${API_URL}/api/models/status`;
            try {
                const response = await fetch(apiUrl);
                if (response.ok) {
                    const data = await response.json();
                    
                    // Only log to console on first call or if there's an issue
                    if (!window.resourcesLogged) {
                        logApiCall('response', 'GET', apiUrl, {
                            status: 200,
                            result: {
                                active_models: data.active_models,
                                ram_usage: `${data.resource_usage.ram_mb}MB`,
                                cpu_usage: `${data.resource_usage.cpu_percent.toFixed(1)}%`
                            }
                        });
                        window.resourcesLogged = true;
                    }
                    
                    document.getElementById('ramUsage').textContent = 
                        `${data.resource_usage.ram_mb}MB / ${data.resource_usage.ram_limit_mb}MB`;
                    document.getElementById('cpuUsage').textContent = 
                        `${data.resource_usage.cpu_percent.toFixed(1)}%`;
                    document.getElementById('activeModels').textContent = 
                        `${data.active_models.length} active`;
                }
            } catch (error) {
                logApiCall('error', 'GET', apiUrl, {
                    message: error.message || 'Failed to fetch model status'
                });
                console.error('Resource update error:', error);
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            // Try to connect WebSocket
            // connectWebSocket(); // Uncomment when WebSocket server is running
            
            // Add initial console message
            logApiCall('response', 'GET', `${API_URL}/api/models/status`, {
                status: 200,
                result: {
                    message: 'API Console initialized',
                    endpoints: [
                        '/api/recognize/lightweight - Card recognition',
                        '/api/models/status - System resources',
                        '/api/tcg/validate - Pokemon TCG API (when available)'
                    ]
                }
            });
            
            // Update resources periodically
            updateResources();
            setInterval(updateResources, 5000);
            
            updateStatus('System Ready', true);
        });
    </script>
</body>
</html>
